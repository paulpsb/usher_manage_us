<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.usher.dao.InternalExamsSpeakingDao">
	<select id="getInternalExamsSpeakingCount" resultType="com.usher.dto.InternalExamsSpeakingDto" parameterType="com.usher.dto.InternalExamsSpeakingDto">
		select count(*) as total_count
		from 
			internal_exams_speaking
		where 1 = 1
		<if test="section != null and section !='' ">			
			and section = #{section}
		</if>
		<if test="book != null and book !='' ">			
			and book = #{book}
		</if>
	</select>
	
	<select id="getInternalExamsSpeakingList" resultType="com.usher.dto.InternalExamsSpeakingDto" parameterType="com.usher.dto.InternalExamsSpeakingDto">
		select 
			id,
			section,
			book,
			volume,
			"group",
			article,
			question
		from
			internal_exams_speaking
		where 1 = 1
		<if test="section != null and section !='' ">			
			and section = #{section}
		</if>
		<if test="book != null and book !='' ">			
			and book = #{book}
		</if>
		order by book, article
		limit #{row_num} offset #{first_num}
	</select>

	<select id="getInternalExamsSpeakingExcelList" resultType="com.usher.dto.InternalExamsSpeakingDto" parameterType="com.usher.dto.InternalExamsSpeakingDto">
		select 
			id,
			section,
			book,
			volume,
			"group",
			article,
			question
		from
			internal_exams_speaking
		order by book, article
	</select>
	
	<select id="getInternalExamsSpeaking" resultType="com.usher.dto.InternalExamsSpeakingDto" parameterType="com.usher.dto.InternalExamsSpeakingDto">
		select 
			a.id,
			a.section,
			a.book,
			a.volume,
			a."group",
			a.article,
			a.title,
			a.passage,
			a.question,
			a.sound,
			a.sound_script
		from
			internal_exams_speaking a
		where
			a.id = #{id}
	</select>
	
	<select id="getInternalExamsSpeakingAsArticle" resultType="com.usher.dto.InternalExamsSpeakingDto" parameterType="com.usher.dto.InternalExamsSpeakingDto">
		select 
			a.id,
			a.section,
			a.book,
			a.volume,
			a."group",
			a.article,
			a.title,
			a.passage,
			a.question,
			a.sound,
			a.sound_script
		from
			internal_exams_speaking a
		where
			a.section = #{section}
			and a.book = #{book}
			and a.volume = #{volume}
			and a."group" = #{group}
			and a.article = #{article}
	</select>
	
	<insert id="insertInternalExamsSpeaking" parameterType="com.usher.dto.InternalExamsSpeakingDto"  useGeneratedKeys="true" keyProperty="id">
		insert into internal_exams_speaking (
			created,
			modified,
			section,
			book,
			volume,
			"group",
			article,
			title,
			passage,
			question,
			sound_script
		) values (
			now(),
			now(),
			#{section},
			#{book},
			#{volume},
			#{group},
			#{article},
			#{title},
			#{passage},
			#{question},
			#{sound_script}
		)
	</insert>
	
	<update id="updateInternalExamsSpeaking" parameterType="com.usher.dto.InternalExamsSpeakingDto">
		update internal_exams_speaking set
			modified = now(),
			title = #{title},
			passage = #{passage},
			question = #{question},
			sound_script = #{sound_script}
		where
			id = #{id}	
	</update>
	
	<delete id="deleteInternalExamsSpeaking" parameterType="com.usher.dto.InternalExamsSpeakingDto">
		delete from internal_exams_speaking
		where
			id = #{id}	
	</delete>
</mapper>