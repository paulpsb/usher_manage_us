<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.usher.dao.NoticesTaskDetailDao">
	<select id="getNoticesTaskDetailList" resultType="com.usher.dto.NoticesTaskDetailDto" parameterType="com.usher.dto.NoticesTaskDetailDto">
		select
			a.id,
			a.detail_user_id,
			concat(b.last_name, b.first_name) as detail_user_name,
			to_char(a.detail_date,'yyyy-mm-dd') as detail_date,
			to_char(a.detail_date,'hh24:mi:ss') as detail_time,
			a.task_id,
			a.task_seq,
			a.task_status,
			a.task_user_id,
			a.task_date,
			a.task_time,
			a.task_title,
			a.task_reference_title,
			a.task_reference_content,
			a.task_reference_image,
			a.task_reference_image_name,
			a.task_reference_url,
			a.task_reference_file,
			a.task_reference_file_name,
			a.task_report_image,
			a.task_report_url,
			a.task_report_file,
			a.task_content,
			a.task_image,
			a.task_image_name,
			a.task_url,
			a.task_file,
			a.task_file_name,
			a.task_return_content,
			a.task_category_detail_id
		from
			notices_task_detail a
			join auth_user b on a.detail_user_id = b.id
		where
			a.task_id = #{task_id}
		order by a.task_seq		
	</select>
	<select id="getNoticesTaskDetailSeq" resultType="com.usher.dto.NoticesTaskDetailDto">
		select
			coalesce(max(task_seq),0) + 1 as task_seq
		from
			notices_task_detail
		where
			task_id = #{task_id}			
	</select>	
	
	<insert id="insertNoticesTaskDetail" parameterType="com.usher.dto.NoticesTaskDetailDto">
		insert into notices_task_detail(
			detail_user_id,
			detail_date,
			task_id,
			task_seq,
			task_status,
			task_user_id,
			task_date,
			task_time,
			task_title,
			task_reference_title,
			task_reference_content,
			task_reference_image,
			task_reference_image_name,
			task_reference_url,
			task_reference_file,
			task_reference_file_name,
			task_report_image,
			task_report_url,
			task_report_file,
			task_content,
			task_image,
			task_image_name,
			task_url,
			task_file,
			task_file_name,
			task_return_content,
			task_category_detail_id
		) values ( 
			#{detail_user_id},
			now(),
			#{task_id},
			#{task_seq},
			#{task_status},
			#{task_user_id},
			to_date(#{task_date},'yyyy-mm-dd'),
			#{task_time},
			#{task_title},
			#{task_reference_title},
			#{task_reference_content},
			#{task_reference_image},
			#{task_reference_image_name},
			#{task_reference_url},
			#{task_reference_file},
			#{task_reference_file_name},
			#{task_report_image},
			#{task_report_url},
			#{task_report_file},
			#{task_content},
			#{task_image},
			#{task_image_name},
			#{task_url},
			#{task_file},
			#{task_file_name},
			#{task_return_content},
			#{task_category_detail_id}
		)
	</insert>	
	
</mapper>