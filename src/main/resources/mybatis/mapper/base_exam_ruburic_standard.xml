<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.usher.dao.BaseExamRuburicStandardDao">
	<select id="getBaseExamRuburicStandardList" resultType="com.usher.dto.BaseExamRuburicStandardDto">
		select
			a.section,
			b.book
		from 
			practices_practicesection a
			join practices_practicebook b on a.id = b.practice_section_id
		where
			a.section in ('SPEAKING', 'WRITING')
			and b.book not in ('지문과 관련없는 OX시험들','암기시험')
		order by a.section_order, b.book_order
	</select>
	
	<select id="getBaseExamRuburicStandard" parameterType="com.usher.dto.BaseExamRuburicStandardDto" resultType="com.usher.dto.BaseExamRuburicStandardDto">
		select
			id,
			section,
			book,
			ruburic_standard
		from
			base_exam_ruburic_standard
		where
			section = #{section}
			and book = #{book}
	</select>
	
	<insert id="insertBaseExamRuburicStandard" parameterType="com.usher.dto.BaseExamRuburicStandardDto">
		with upsert as(
			update base_exam_ruburic_standard set 
				modified = now(),
				ruburic_standard = #{ruburic_standard}
			where section = #{section} and book = #{book} returning *
		)
		insert into base_exam_ruburic_standard (
			created,
			modified,
			section, 
			book,
			ruburic_standard
		)
		select 
			now(),
			now(),
			#{section}, 
			#{book},
			#{ruburic_standard}
		where 
			not exists ( select * from upsert )
	</insert>	
</mapper>